{% extends 'base.html.twig' %}
{% block content %}
    <div class="col-sm-12 col-md-12 col-lg-3">
        <div class="jarviswidget jarviswidget-color-blueDark">
            <header>
                <h2> Agregar eventos </h2>
            </header>
            <div>
                <div class="widget-body">
                    <form id="add-event-form">
                        <fieldset>
                            <div class="form-group">
                                <label>Icono</label>
                                <div class="btn-group btn-group-sm btn-group-justified" data-toggle="buttons">
                                    <label class="btn btn-default active">
                                        <input type="radio" name="icono" id="icon-1" value="fa-info" checked>
                                        <i class="fa fa-info text-muted"></i> </label>
                                    <label class="btn btn-default">
                                        <input type="radio" name="icono" id="icon-2" value="fa-warning">
                                        <i class="fa fa-warning text-muted"></i> </label>
                                    <label class="btn btn-default">
                                        <input type="radio" name="icono" id="icon-3" value="fa-check">
                                        <i class="fa fa-check text-muted"></i> </label>
                                    <label class="btn btn-default">
                                        <input type="radio" name="icono" id="icon-4" value="fa-user">
                                        <i class="fa fa-user text-muted"></i> </label>
                                    <label class="btn btn-default">
                                        <input type="radio" name="icono" id="icon-5" value="fa-lock">
                                        <i class="fa fa-lock text-muted"></i> </label>
                                    <label class="btn btn-default">
                                        <input type="radio" name="icono" id="icon-6" value="fa-clock-o">
                                        <i class="fa fa-clock-o text-muted"></i> </label>
                                </div>
                            </div>
                            <div class="form-group">
                                <label>Titulo</label>
                                <input class="form-control" id="titulo" name="titulo" maxlength="40" type="text"
                                       placeholder="Ingrese un titulo para el evento">
                            </div>
                            <div class="form-group">
                                <label>Desde</label>
                                <input class="form-control" type="datetime-local" name="fechaDesde" id="fechaDesde">
                            </div>
                            <div class="form-group">
                                <label>Hasta</label>
                                <input class="form-control" type="datetime-local" name="fechaHasta" id="fechaHasta">
                            </div>
                            <div class="form-group">
                                <label>Descripcion</label>
                                <textarea class="form-control"
                                          placeholder="Ingrese una corta descripcion para el evento" rows="3"
                                          maxlength="40" id="descripcion"></textarea>
                                <p class="note">Maximo 40 caracteres</p>
                            </div>
                            <div class="form-group">
                                <label>Color</label>
                                <div class="btn-group btn-group-justified btn-select-tick" data-toggle="buttons">
                                    <label class="btn bg-color-darken active">
                                        <input type="radio" name="color" id="option1"
                                               value="bg-color-darken txt-color-white" checked>
                                        <i class="fa fa-check txt-color-white"></i> </label>
                                    <label class="btn bg-color-blue">
                                        <input type="radio" name="color" id="option2"
                                               value="bg-color-blue txt-color-white">
                                        <i class="fa fa-check txt-color-white"></i> </label>
                                    <label class="btn bg-color-orange">
                                        <input type="radio" name="color" id="option3"
                                               value="bg-color-orange txt-color-white">
                                        <i class="fa fa-check txt-color-white"></i> </label>
                                    <label class="btn bg-color-greenLight">
                                        <input type="radio" name="color" id="option4"
                                               value="bg-color-greenLight txt-color-white">
                                        <i class="fa fa-check txt-color-white"></i> </label>
                                    <label class="btn bg-color-blueLight">
                                        <input type="radio" name="color" id="option5"
                                               value="bg-color-blueLight txt-color-white">
                                        <i class="fa fa-check txt-color-white"></i> </label>
                                    <label class="btn bg-color-red">
                                        <input type="radio" name="color" id="option6"
                                               value="bg-color-red txt-color-white">
                                        <i class="fa fa-check txt-color-white"></i> </label>
                                </div>
                            </div>
                        </fieldset>
                        <div class="form-actions">
                            <div class="row">
                                <div class="col-md-12">
                                    <button class="btn btn-default" type="button" id="add-event">
                                        Agregar
                                    </button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <div class="col-sm-12 col-md-12 col-lg-9">
        <div class="jarviswidget jarviswidget-color-blueDark">
            <header>
                <span class="widget-icon"> <i class="fa fa-calendar"></i> </span>
                <h2> Mis eventos </h2>
                <div class="widget-toolbar">
                    <div class="btn-group">
                        <button class="btn dropdown-toggle btn-xs btn-default" data-toggle="dropdown">
                            Mostrar <i class="fa fa-caret-down"></i>
                        </button>
                        <ul class="dropdown-menu js-status-update pull-right">
                            <li>
                                <a href="javascript:void(0);" id="mes">Mes</a>
                            </li>
                            <li>
                                <a href="javascript:void(0);" id="agenda">Agenda</a>
                            </li>
                            <li>
                                <a href="javascript:void(0);" id="hoy">Hoy</a>
                            </li>
                        </ul>
                    </div>
                </div>
            </header>
            <div>
                <div class="widget-body no-padding">
                    <div class="widget-body-toolbar">
                        <div id="calendar-buttons">
                            <div class="btn-group">
                                <a href="javascript:void(0)" class="btn btn-default btn-xs" id="btn-prev"><i
                                            class="fa fa-chevron-left"></i></a>
                                <a href="javascript:void(0)" class="btn btn-default btn-xs" id="btn-next"><i
                                            class="fa fa-chevron-right"></i></a>
                            </div>
                        </div>
                    </div>
                    <div id="calendar"></div>
                </div>
            </div>
        </div>
    </div>
    <div>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
    </div>
    <script>
        $(document).ready(function () {
            cargarEvento();
            cargarCalendario();
        });
        $('#add-event').click(function () {
            guardarEvento();
            cargarCalendario();
        });

        function cargarCalendario() {
            pageSetUp();
            "use strict";
            $('#calendar').fullCalendar({
                header: {
                    left: 'title',
                    center: 'month,agendaWeek,agendaDay',
                    right: 'prev,today,next'
                },
                editable: false,
                droppable: false,

                eventRender: function (event, element, icon) {
                    if (!event.description == "") {
                        element.find('.fc-title').append("<br/><span class='ultra-light'>" + event.description +
                            "</span>");
                    }
                    if (!event.icon == "") {
                        element.find('.fc-title').append(
                            "<i class='air air-bottom-right fa " + event.icon + " '></i>" +
                            "<i class='air air-top-right fa fa-trash-o' id='" + event.pk + "' onclick='eliminar(this.id)'></i>");
                    }
                }
            });
            /* hide default buttons */
            $('.fc-right, .fc-center').hide();
            $('#calendar-buttons #btn-prev').click(function () {
                $('.fc-prev-button').click();
                return false;
            });
            $('#calendar-buttons #btn-next').click(function () {
                $('.fc-next-button').click();
                return false;
            });
            $('#calendar-buttons #btn-today').click(function () {
                $('.fc-today-button').click();
                return false;
            });
            //Cambia el tipo de vista
            $('#mes').click(function () {
                $('#calendar').fullCalendar('changeView', 'month');
            });
            $('#agenda').click(function () {
                $('#calendar').fullCalendar('changeView', 'agendaWeek');
            });
            $('#hoy').click(function () {
                $('#calendar').fullCalendar('changeView', 'agendaDay');
            });
        }

        function guardarEvento() {
            if (!$('#titulo').val()) {
                return alert('Debe ingresar un titulo.');
            } else if (!$('#fechaDesde').val()) {
                return alert('Debe seleccionar una fecha de inicio.');
            } else if (!$('#fechaHasta').val()) {
                return alert('Debe seleccionar una fecha de finalizacion.');
            } else if (!$('#descripcion').val()) {
                return alert('Debe seleccionar una descripcion.');
            }
            $.ajax({
                url: "{{ path('calendario_evento_guardar') }}",
                type: "GET",
                dataType: "JSON",
                data: {
                    icono: $('input:radio[name=icono]:checked').val(),
                    titulo: $('#titulo').val(),
                    desde: $('#fechaDesde').val(),
                    hasta: $('#fechaHasta').val(),
                    descripcion: $('#descripcion').val(),
                    color: $('input:radio[name=color]:checked').val(),
                },
                success: function () {
                    cargarEvento();
                },
            })
        }

        function cargarEvento() {
            $.ajax({
                url: "{{ path('calendario_evento_listar') }}",
                type: "GET",
                dataType: "JSON",
                data: {},
                success: function (eventos) {
                    var calendario = $('#calendar');
                    calendario.fullCalendar('removeEvents');
                    $.each(eventos, function (key, valor) {
                        var objetoEvento = {
                            title: valor.title,
                            start: new Date(valor.start),
                            end: new Date(valor.end),
                            description: valor.description,
                            className: valor.classname,
                            icon: valor.icon,
                            pk: valor.pk
                        };
                        calendario.fullCalendar('renderEvent', objetoEvento, true);
                    });
                },
            });
        }

        function eliminar(id) {
            console.log(id);
            var respuesta = confirm('Esta seguro de eliminar el evento?');
            if (respuesta) {
                $.ajax({
                    url: "{{ path('calendario_evento_eliminar') }}",
                    type: "GET",
                    dataType: "JSON",
                    data: {
                        id: id
                    },
                    success: function () {
                        cargarEvento();
                    },
                });
            }
        }
    </script>
{% endblock %}